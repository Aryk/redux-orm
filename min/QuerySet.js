"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_lodashCollectionReject=require("lodash/collection/reject"),_lodashCollectionReject2=_interopRequireDefault(_lodashCollectionReject),_lodashCollectionFilter=require("lodash/collection/filter"),_lodashCollectionFilter2=_interopRequireDefault(_lodashCollectionFilter),_lodashCollectionSortByOrder=require("lodash/collection/sortByOrder"),_lodashCollectionSortByOrder2=_interopRequireDefault(_lodashCollectionSortByOrder),_constantsJs=require("./constants.js"),QuerySet=function(){function e(t,r,n){_classCallCheck(this,e),Object.assign(this,{modelClass:t,idArr:r}),this._opts=n,n&&n.hasOwnProperty("plain")?this._plain=n.plain:this._plain=!1}return _createClass(e,[{key:"_new",value:function(e){var t=this._plain,r=Object.assign({},this._opts,{plain:t});return new this.constructor(this.modelClass,e,r)}},{key:"toString",value:function(){var e=this;return"QuerySet contents: \n    - "+this.idArr.map(function(t){return e.modelClass.withId(t).toString()}).join("\n    - ")}},{key:"toPlain",value:function(){var e=this;return this.idArr.map(function(t){return e.modelClass.accessId(t)})}},{key:"count",value:function(){return this.idArr.length}},{key:"exists",value:function(){return Boolean(this.count())}},{key:"at",value:function(e){return this._plain?this.modelClass.accessId(this.idArr[e]):this.modelClass.get(_defineProperty({},this.modelClass.idAttribute,this.idArr[e]))}},{key:"first",value:function(){return this.at(0)}},{key:"last",value:function(){return this.at(this.idArr.length-1)}},{key:"all",value:function(){return this._new(this.idArr)}},{key:"objects",value:function(){var e=this;return this.idArr.map(function(t,r){return e.at(r)})}},{key:"filter",value:function(e){return this._filterOrExclude(e,!1)}},{key:"exclude",value:function(e){return this._filterOrExclude(e,!0)}},{key:"_filterOrExclude",value:function(e,t){var r=this,n=t?_lodashCollectionReject2["default"]:_lodashCollectionFilter2["default"],i=void 0;i="function"==typeof e?this.objects():this.plain.objects();var l=n(i,e),o=this._plain?function(e){return e[r.modelClass.idAttribute]}:function(e){return e.getId()},s=l.map(o);return this._new(s)}},{key:"map",value:function(e){var t=this;return this.idArr.map(function(r,n){return e(t.at(n))})}},{key:"orderBy",value:function(e){var t=this,r=_lodashCollectionSortByOrder2["default"].apply([this.objects()].concat(e));return this._new(r.map(function(e){return e[t.modelClass.idAttribute]}))}},{key:"update",value:function(e){this.modelClass.addMutation({type:_constantsJs.UPDATE,payload:{idArr:this.idArr,updater:e}})}},{key:"delete",value:function(){this.modelClass.addMutation({type:_constantsJs.DELETE,payload:this.idArr})}},{key:"plain",get:function(){return this._plain=!0,this}},{key:"models",get:function(){return this._plain=!1,this}}],[{key:"addSharedMethod",value:function(e){this.sharedMethods=this.sharedMethods.concat(e)}}]),e}();QuerySet.sharedMethods=["toPlain","count","at","all","last","first","exists","filter","map","exclude","orderBy","update","delete"],exports["default"]=QuerySet,module.exports=exports["default"];