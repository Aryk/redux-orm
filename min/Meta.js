"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),_lodashCollectionFind=require("lodash/collection/find"),_lodashCollectionFind2=_interopRequireDefault(_lodashCollectionFind),_lodashCollectionSortByOrder=require("lodash/collection/sortByOrder"),_lodashCollectionSortByOrder2=_interopRequireDefault(_lodashCollectionSortByOrder),_lodashObjectOmit=require("lodash/object/omit"),_lodashObjectOmit2=_interopRequireDefault(_lodashObjectOmit),_utils=require("./utils"),Meta=function(){function e(t){_classCallCheck(this,e);var r={_name:null,idAttribute:"id",branchName:null,indexById:!0,ordered:!0,arrName:"items",mapName:"itemsById"};if(!t.name)throw new Error("You must give a name for the Model in getMeta.");t.branchName||(t.branchName=t.name),t._name=t.name,delete t.name,Object.assign(this,r,t)}return _createClass(e,[{key:"accessId",value:function(e,t){return this.indexById?e[this.mapName][t]:(0,_lodashCollectionFind2["default"])(e[this.arrName],_defineProperty({},this.idAttribute,t))}},{key:"accessIdList",value:function(e){return e[this.arrName]}},{key:"iterator",value:function(e){var t=this;return this.indexById?new _utils.ListIterator(e[this.arrName],0,function(r,i){return e[t.mapName][r[i]]}):new _utils.ListIterator(e[this.arrName],0)}},{key:"accessList",value:function(e){var t=this;return e[this.arrName].map(function(r){var i=t.accessId(e,r);return Object.assign(_defineProperty({},t.idAttribute,r),i)})}},{key:"getDefaultState",value:function(){if(this.indexById){var e;return e={},_defineProperty(e,this.arrName,[]),_defineProperty(e,this.mapName,{}),e}return _defineProperty({},this.arrName,[])}},{key:"order",value:function(e,t,r){var i=this,n=this.arrName,a=this.mapName;if(this.indexById){var o,u=this.accessList(e),s=(0,_lodashCollectionSortByOrder2["default"])(u,t,r);return o={},_defineProperty(o,n,s.map(function(e){return e[i.idAttribute]})),_defineProperty(o,a,e[a]),o}return _defineProperty({},n,(0,_lodashCollectionSortByOrder2["default"])(e[n],t,r))}},{key:"insert",value:function(e,t){if(this.indexById){var r,i=t[this.idAttribute];return r={},_defineProperty(r,this.arrName,e[this.arrName].concat(i)),_defineProperty(r,this.mapName,Object.assign({},e[this.mapName],_defineProperty({},i,t))),r}return _defineProperty({},this.arrName,e[this.arrName].concat(t))}},{key:"update",value:function(e,t,r){var i=this.arrName,n=this.mapName,a=this.idAttribute,o=void 0;if(o="function"==typeof r?r:function(e){return Object.assign({},e,r)},this.indexById){var u,s={};return t.reduce(function(t,r){return t[r]=o(e[n][r]),t},s),u={},_defineProperty(u,i,e[i]),_defineProperty(u,n,Object.assign({},e[n],s)),u}var l=e[i].slice();return _defineProperty({},i,l.map(function(e){return t.includes(e[a])?o(e):e}))}},{key:"delete",value:function(e,t){var r=this.arrName,i=this.mapName,n=this.idAttribute;if(this.indexById){var a;return a={},_defineProperty(a,r,e[r].filter(function(e){return!t.includes(e)})),_defineProperty(a,i,(0,_lodashObjectOmit2["default"])(e[i],t)),a}return _defineProperty({},r,e[r].filter(function(e){return!t.includes(e[n])}))}},{key:"name",get:function(){return this._name}}]),e}();exports.Meta=Meta,exports["default"]=Meta;